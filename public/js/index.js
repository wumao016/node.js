$(function(){
	var $loginbox=$("#loginbox");
	var $registerbox=$("#registerbox");
	var $userInfo=$("#userInfo");
	$loginbox.find("a").on('click',function(){
		$registerbox.show();
		$loginbox.hide();
	});
	$registerbox.find("a").on('click',function(){
		$loginbox.show();
		$registerbox.hide();
	});
	$registerbox.find("button").on('click',function(){
		$.ajax({
			type:"post",
			url:'/api/user/register',
			data:{
				username:$registerbox.find('[name="username"]').val(),
				password:$registerbox.find('[name="password"]').val(),
				repassword:$registerbox.find('[name="repassword"]').val()
			},
			dataType:'json',
			success:function(result){
				$registerbox.find(".textcenter").html(result.message);
				if(!result.code){
					setTimeout(function(){
						$loginbox.show();
						$registerbox.hide();
					},1000)
				}
			}
		});
	});
	//登录
	$loginbox.find("button").on('click',function(){
		$.ajax({
			type:"post",
			url:'/api/user/login',
			data:{
				username:$loginbox.find('[name="username"]').val(),
				password:$loginbox.find('[name="password"]').val()
			},
			dataType:'json',
			success:function(result){
				$loginbox.find(".textcenter").html(result.message);
				if(!result.code){
					setTimeout(function(){
						$loginbox.hide();
						$userInfo.show();
						$userInfo.find('.username').html(result.userInfo.username);
						$userInfo.find('.info').html('你好，欢迎光临博客');
					},1000)
					//登录成功
					window.location.reload();
				}
			}
		});
	})
	//退出
	$('#logout').on('click',function(){
		$.ajax({
			url:'/api/user/logout',
			success:function(result){
				if(!result.code){
					window.location.reload();
				}
			}
		})
	})
})
